# GuShen å¹³å°å…¨é¢å‡çº§è®¡åˆ’ | Platform Comprehensive Upgrade Plan

> **ç‰ˆæœ¬ / Version**: v2.0
> **åˆ›å»ºæ—¥æœŸ / Created**: 2026-01-23
> **æœ€åæ›´æ–° / Last Updated**: 2026-01-24
> **é¢„è®¡å·¥æœŸ / Timeline**: 6-8å‘¨ / 6-8 weeks
> **é£é™©ç­‰çº§ / Risk Level**: ä¸­é«˜ / Medium-Highï¼ˆæ¶‰åŠæ ¸å¿ƒæ¶æ„æ”¹é€ ï¼‰

---

## ğŸ¯ æ‰§è¡Œæ‘˜è¦ | Executive Summary

æœ¬è®¡åˆ’æ—¨åœ¨å¯¹GuShen AIé‡åŒ–äº¤æ˜“å¹³å°è¿›è¡Œ**å…¨é¢å‡çº§**ï¼ŒåŒ…æ‹¬bugä¿®å¤ã€UIä¼˜åŒ–ã€ç”¨æˆ·ç³»ç»Ÿæ”¹é€ ã€ä»¥åŠåç«¯AI Agentæ¡†æ¶å‡çº§ã€‚

This plan aims to comprehensively upgrade the GuShen AI quantitative trading platform, including bug fixes, UI optimization, user system renovation, and backend AI Agent framework upgrades.

### æ ¸å¿ƒç›®æ ‡ | Core Objectives

| ç±»åˆ« | éœ€æ±‚ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
|------|------|--------|------|
| ğŸ› **Bugä¿®å¤** | å¤šç©ºè¾©è®ºæ•°æ®æ ¼å¼é”™è¯¯ | P0 | âœ… å·²å®Œæˆ |
| ğŸ› **Bugä¿®å¤** | ç­–ç•¥éªŒè¯é¡µé¢é€‰æ‹©å™¨ | P0 | âœ… å·²å®Œæˆ |
| ğŸ¨ **UIä¼˜åŒ–** | ä»£ç æ¡†æŠ˜å ã€å‘½åã€æ’ç‰ˆ | P1 | âœ… å·²å®Œæˆ |
| ğŸ‘¤ **ç”¨æˆ·ç³»ç»Ÿ** | è´¦æˆ·éš”ç¦»ã€ç™»å½•çŠ¶æ€æ˜¾ç¤º | P0 | âœ… å·²å®Œæˆ |
| ğŸ¤– **Agentå‡çº§** | LangChain/LangGraphé›†æˆ | P1 | âœ… å·²å®Œæˆ |
| ğŸ“Š **æ•°æ®å¢å¼º** | å†å²æ•°æ®é‡‡é›†ã€ç¼“å­˜ä¼˜åŒ– | P1 | âœ… å·²å®Œæˆ |
| ğŸ’¼ **äº¤æ˜“é¢æ¿** | åŠŸèƒ½å®Œæ•´æ€§ã€ä¿¡æ¯å±•ç¤º | P2 | âœ… å·²å®Œæˆ |

---

## ğŸ“‹ å®æ–½é˜¶æ®µ | Implementation Phases

### Phase 1: Bugä¿®å¤ä¸å¿«é€Ÿä¼˜åŒ– âœ… å·²å®Œæˆ

**å®Œæˆæ—¥æœŸ**: 2026-01-23

**å·²å®Œæˆé¡¹**:
- [x] ä¿®å¤å¤šç©ºè¾©è®ºBugï¼ˆparticipantså­—æ®µç¼ºå¤±ï¼‰
- [x] ç­–ç•¥ä»£ç æ¡†é»˜è®¤æŠ˜å ï¼ˆ`defaultCollapsed = true`ï¼‰
- [x] "AIç­–ç•¥åŠ©æ‰‹"æ”¹åä¸º"ç­–ç•¥åŠ©æ‰‹"
- [x] ç­–ç•¥éªŒè¯é¡µé¢é€‰æ‹©å™¨ä¿®å¤ï¼ˆAPIæ•°æ®æ ¼å¼é€‚é…ï¼‰
- [x] éªŒè¯æ’ç‰ˆæ— é‡å 

### Phase 2: æ•°æ®åº“Schemaä¸ç”¨æˆ·ç³»ç»Ÿ âœ… å·²å®Œæˆ

**å®Œæˆæ—¥æœŸ**: 2026-01-23

**å·²å®ç°æ•°æ®åº“è¡¨**:
- [x] `users` - ç”¨æˆ·è®¤è¯è¡¨
- [x] `userPreferences` - ç”¨æˆ·åå¥½è¡¨
- [x] `userDrafts` - è‰ç¨¿å­˜å‚¨è¡¨
- [x] `tenants`, `tenantMembers` - å¤šç§Ÿæˆ·æ”¯æŒ
- [x] `strategyHistory` - ç­–ç•¥å†å²ï¼ˆç‰ˆæœ¬æ§åˆ¶ï¼‰
- [x] `backtestHistory` - å›æµ‹å†å²
- [x] `tradingHistory` - äº¤æ˜“å†å²

**å·²å®ç°åŠŸèƒ½**:
- [x] `withUser` è®¤è¯ä¸­é—´ä»¶
- [x] `withRole` è§’è‰²çº§è®¿é—®æ§åˆ¶
- [x] Dashboardç»Ÿä¸€å¤´éƒ¨ç»„ä»¶ï¼ˆè´¦æˆ·çŠ¶æ€æ˜¾ç¤ºï¼‰

### Phase 3: LangGraphJS + Agent Protocolé›†æˆ âœ… å·²å®Œæˆ

**å®Œæˆæ—¥æœŸ**: 2026-01-23

**ä¾èµ–å®‰è£…**:
- [x] `@langchain/langgraph` 0.2.38
- [x] `@langchain/core` 0.3.26
- [x] `@langchain/openai` 0.3.17

**Agent Protocol API**:
- [x] `/api/agent-protocol/runs` - æ— çŠ¶æ€æ‰§è¡Œ
- [x] `/api/agent-protocol/runs/stream` - æµå¼æ‰§è¡Œ
- [x] `/api/agent-protocol/threads` - ä¼šè¯ç®¡ç†
- [x] `/api/agent-protocol/threads/[id]` - ä¼šè¯è¯¦æƒ…
- [x] `/api/agent-protocol/threads/[id]/runs` - ä¼šè¯ä¸­è¿è¡Œ
- [x] `/api/agent-protocol/store/items` - è®°å¿†å­˜å‚¨

**LangGraphJSå®ç°**:
- [x] `graphs/advisor-graph.ts` - æŠ•èµ„é¡¾é—®Graph
- [x] `graphs/types.ts` - çŠ¶æ€ç±»å‹å®šä¹‰
- [x] `tools/indicator-tools.ts` - æŠ€æœ¯æŒ‡æ ‡Tools
- [x] `tools/market-tools.ts` - å¸‚åœºæ•°æ®Tools
- [x] `stores/thread-store.ts` - ä¼šè¯å­˜å‚¨

### Phase 4: å†å²è®°å½•ä¸äº¤æ˜“é¢æ¿å¢å¼º âœ… å·²å®Œæˆ

**å®Œæˆæ—¥æœŸ**: 2026-01-23

**å·²å®ç°åŠŸèƒ½**:
- [x] å†å²è®°å½•é¡µé¢ `/dashboard/history`
- [x] äº”æ¡£è¡Œæƒ…ç»„ä»¶ `OrderbookPanel`
- [x] æŠ€æœ¯æŒ‡æ ‡é¢æ¿ `IndicatorQuickPanel`
- [x] Dashboardç»Ÿä¸€å¤´éƒ¨ï¼ˆæ‰€æœ‰é¡µé¢ï¼‰
- [x] è´¦æˆ·çŠ¶æ€æ˜¾ç¤ºï¼ˆç”¨æˆ·è§’è‰²å¾½ç« ï¼‰

### Phase 5: æ•°æ®é‡‡é›†ä¸“é¡¹å®æ–½ âœ… å·²å®Œæˆ

**å®Œæˆæ—¥æœŸ**: 2026-01-23

**å·²å®ç°åŠŸèƒ½**:
- [x] Kçº¿æ•°æ®æŒä¹…åŒ–æ¨¡å— `kline-persister.ts`
- [x] æŒ‰éœ€æ•°æ®é‡‡é›†API `/api/data/fetch`
- [x] å›æµ‹APIè‡ªåŠ¨æŒä¹…åŒ–
- [x] æ•°æ®å¯¼å…¥è„šæœ¬ `import-initial-data.ts`

### Phase 6: ç´§æ€¥ä¿®å¤ v1.2.1 âœ… å·²å®Œæˆ

**å®Œæˆæ—¥æœŸ**: 2026-01-23

**å·²å®ç°åŠŸèƒ½**:
- [x] é£é™©å£°æ˜ç»„ä»¶ `RiskDisclaimer`
- [x] ç™»å½•/æ³¨å†Œé¡µé¢é£é™©æç¤º
- [x] ä¸‰é“å…­æœ¯æ”¹ä¸ºå¯é€‰ä¸Šä¸‹æ–‡
- [x] å¤§å¸ˆè§†è§’æˆ˜æ³•æ ¸å¿ƒå¢å¼º

---

## ğŸ“Š æŠ€æœ¯æ¶æ„ | Technical Architecture

### æŠ€æœ¯æ ˆ | Technology Stack

| å±‚çº§ | æŠ€æœ¯ | ç‰ˆæœ¬ |
|------|------|------|
| è¿è¡Œæ—¶ | Bun | 1.1+ |
| å‰ç«¯æ¡†æ¶ | Next.js | 15.1.0 |
| Agentæ¡†æ¶ | LangGraphJS | 0.2.38 |
| æ•°æ®åº“ | PostgreSQL + Drizzle ORM | 0.38.0 |
| ç¼“å­˜ | Redis (IORedis) | 5.9.2 |
| è®¤è¯ | NextAuth.js | 5.0.0-beta.25 |

### æ¶æ„æ€»è§ˆ | Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Next.js 15 Frontend                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Dashboard  â”‚  â”‚   Trading   â”‚  â”‚   Strategy Editor   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Agent Protocol API Layer (æ¡†æ¶æ— å…³)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ /runs   â”‚  â”‚ /threads  â”‚  â”‚ /store  â”‚  â”‚  /agents    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  LangGraphJS 0.2.38 Engine                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Supervisor Agent â”‚  â”‚      11 Analyst Agents         â”‚ â”‚
â”‚  â”‚   (Orchestrator)  â”‚â”€â”€â”‚ Technical | Fundamental | Risk â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Data & LLM Layer                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  PostgreSQL  â”‚  â”‚   Redis   â”‚  â”‚ DeepSeek/Anthropic  â”‚ â”‚
â”‚  â”‚  (Drizzle)   â”‚  â”‚  (Cache)  â”‚  â”‚      LLM API        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… éªŒæ”¶æ ‡å‡† | Acceptance Criteria

### åŠŸèƒ½æ€§æ ‡å‡†

- [x] å¤šç©ºè¾©è®ºèƒ½æ­£å¸¸å¯åŠ¨å¹¶å®Œæˆè¾©è®º
- [x] ç­–ç•¥ä»£ç æ¡†é»˜è®¤æŠ˜å 
- [x] æ‰€æœ‰"AIç­–ç•¥åŠ©æ‰‹"æ”¹ä¸º"ç­–ç•¥åŠ©æ‰‹"
- [x] ç­–ç•¥éªŒè¯é€‰æ‹©å™¨æ­£ç¡®æ˜¾ç¤ºç­–ç•¥å’Œæ¿å—
- [x] ç”¨æˆ·ç™»å½•åçœ‹åˆ°å„è‡ªçš„ç­–ç•¥/å›æµ‹å†å²
- [x] Agent Protocol APIå®Œæ•´å®ç°
- [x] äº”æ¡£è¡Œæƒ…ã€æŠ€æœ¯æŒ‡æ ‡é¢æ¿æ­£å¸¸å·¥ä½œ

### æ€§èƒ½æ ‡å‡†

- APIå“åº”æ—¶é—´ <100msï¼ˆç¼“å­˜å‘½ä¸­ï¼‰
- APIå“åº”æ—¶é—´ <3sï¼ˆAPIè°ƒç”¨ï¼‰
- ç¼“å­˜å‘½ä¸­ç‡ â‰¥85%

### å®‰å…¨æ ‡å‡†

- æ— SQLæ³¨å…¥æ¼æ´
- æ— XSSæ¼æ´
- ç”¨æˆ·æ•°æ®å®Œå…¨éš”ç¦»

---

## ğŸ“š å…³é”®æ–‡ä»¶æ¸…å• | Critical Files

### Agent Protocol API
- `src/app/api/agent-protocol/runs/route.ts`
- `src/app/api/agent-protocol/threads/route.ts`
- `src/app/api/agent-protocol/store/items/route.ts`

### LangGraphJS
- `src/lib/agent/graphs/advisor-graph.ts`
- `src/lib/agent/tools/indicator-tools.ts`
- `src/lib/agent/tools/market-tools.ts`

### æ•°æ®åº“Schema
- `src/lib/db/schema.ts`

### ç”¨æˆ·ç³»ç»Ÿ
- `src/lib/auth/with-user.ts`
- `src/components/dashboard/dashboard-header.tsx`

### æ•°æ®é‡‡é›†
- `src/lib/backtest/kline-persister.ts`
- `src/app/api/data/fetch/route.ts`

---

## ğŸš€ åç»­è§„åˆ’ | Future Enhancements

### çŸ­æœŸ | Short-term (1-2å‘¨)
- [ ] æ·»åŠ è‰ç¨¿å†å²é¢æ¿UI
- [ ] å®ç°æ’¤é”€/é‡åšå¿«æ·é”®
- [ ] æ·»åŠ Kçº¿æ•°æ®ç›‘æ§ä»ªè¡¨æ¿

### ä¸­æœŸ | Medium-term (1ä¸ªæœˆ)
- [ ] å®ç°ç­–ç•¥ç‰ˆæœ¬æ¯”è¾ƒåŠŸèƒ½
- [ ] æ·»åŠ æ•°æ®è´¨é‡è‡ªåŠ¨æŠ¥è­¦
- [ ] ä¼˜åŒ–å¤§æ•°æ®é‡Kçº¿æ€§èƒ½

### é•¿æœŸ | Long-term (3ä¸ªæœˆ)
- [ ] äº‘ç«¯ç­–ç•¥åŒæ­¥
- [ ] åä½œç¼–è¾‘åŠŸèƒ½
- [ ] AIé©±åŠ¨çš„æ•°æ®å¼‚å¸¸æ£€æµ‹

---

**æ–‡æ¡£ç‰ˆæœ¬ / Document Version**: v2.0
**æœ€åæ›´æ–° / Last Updated**: 2026-01-24
